<!DOCTYPE html>
<html lang="en">
<head>
<title>panopo.ly</title>
<meta charset="utf-8">
<meta name="viewport" content="width=device-width, user-scalable=no, minimum-scale=1.0, maximum-scale=1.0">
<link rel="Stylesheet" href="panopoly.css" type="text/css">
<style>

div.Test
{
	margin: 10px;
}

div.Test span
{
	font-weight: normal;
	font-size: 20pt;
	padding:10px;
	margin:2px;
}

#experiment {
	-webkit-perspective: 800px;
	-webkit-perspective-origin: 50% 50px;
	-moz-perspective: 800px;
	-moz-perspective-origin: 50% 50px;
	perspective: 800px;
	perspective-origin: 50% 50px;
}


#cube, #cubeparent {
	position: relative;
	margin: 100px auto;
	height: 100px;
	width: 100px;
	-webkit-transition: -webkit-transform 1s linear;
	-webkit-transform-style: preserve-3d;
	-moz-transition: -moz-transform 1s linear;
	-moz-transform-style: preserve-3d;
	transition: transform 1s linear;
	transform-style: preserve-3d;
}

#cubeparent
{
	/*
		when all translate z is 200....
		far face 1000
		near face 600
		middle z = near + ((far-near)/2) = 800
	 */
}

.face {
	position: absolute;
	height: 100px;
	width: 100px;
	padding: 0px;
	margin: 0px;
	font-size: 20px;
	line-height: 1em;
	color: #fff;
}

#cube .top  {
	-webkit-transform: rotateX(90deg) translateZ(50px);
	-moz-transform: rotateX(90deg) translateZ(50px);
	transform: rotateX(90deg) translateZ(50px);
	
	background-color: red;
	opacity: 0.9;
	background: url(cubemap.jpg);
	background-position: -100px -0px;
	background-size: 400px 300px;	/* image space...scale up with this */
}

#cube .front {
	-webkit-transform: translateZ(50px);
	-moz-transform: translateZ(50px);
	transform: translateZ(50px);

	background-color: lime;
	opacity: 0.9;
	background: url(cubemap.jpg);
	background-position: -300px -100px;
	background-size: 400px 300px;	/* image space...scale up with this */
}

#cube .left {
	-webkit-transform: rotateY(90deg) translateZ(50px);
	-moz-transform: rotateY(90deg) translateZ(50px);
	transform: rotateY(90deg) translateZ(50px);
	
	background-color: blue;
	opacity: 0.9;
	background: url(cubemap.jpg);
	background-position: -0px -100px;
	background-size: 400px 300px;	/* image space...scale up with this */
}

#cube .back {
	-webkit-transform: rotateY(180deg) translateZ(50px);
	-moz-transform: rotateY(180deg) translateZ(50px);
	transform: rotateY(180deg) translateZ(50px);
	
	background-color: yellow;
	opacity: 0.9;
	background: url(cubemap.jpg);
	background-position: -100px -100px;
	background-size: 400px 300px;	/* image space...scale up with this */
}

#cube .right {
	-webkit-transform: rotateY(-90deg) translateZ(50px);
	-moz-transform: rotateY(-90deg) translateZ(50px);
	transform: rotateY(-90deg) translateZ(50px);

	background-color: cyan;
	opacity: 0.9;
	background: url(cubemap.jpg);
	background-position: -200px -100px;
	background-size: 400px 300px;	/* image space...scale up with this */
}

#cube .bottom {
	-webkit-transform: rotateX(-90deg) rotate(180deg) translateZ(50px);
	-moz-transform: rotateX(-90deg) rotate(180deg) translateZ(50px);
	transform: rotateX(-90deg) rotate(180deg) translateZ(50px);

	background-color: magenta;
	opacity: 0.9;
	background: url(cubemap.jpg);
	background-position: -100px -200px;
	background-size: 400px 300px;	/* image space...scale up with this */
}


</style>
</head>

<body>
<div id="info">
	panopo.ly
</div>

<div id="TestContainer"></div>
<div id="UpTest">0</div>

<script src="js/soy.js"></script>
<script src="threejs/three.min.js"></script>
<script src="threejs/effects/StereoEffect.js"></script>
<script src="js/MouseControls.js"></script>
<script src="js/GoogleAnalytics.js"></script>
<script src="js/ClearDefaultText.js"></script>
<script src="js/SoyWebSocket-1.0.js"></script>
<script src="js/panopoly.js"></script>
<script src="js/support.js"></script>
<script src="js/SoySupport.js"></script>
<script src="js/SoyRiftWebsocket.js"></script>
<script src="js/SoySplit.js"></script>
<script src="js/SoyShrink.js"></script>
<script src="js/SoyFullscreen.js"></script>
<script src="js/SoyRiftAjax.js"></script>
<script src="js/SoyGyro.js"></script>
<script src="js/SoyCss3d.js"></script>
<script src="js/SoyFileSelect.js"></script>
<script src="js/SoyMouse.js"></script>



<div class="experiment-body clearfix">
    
	<div class="test test-3dtransforms">
<div id="experiment">
	
	<div id="cubeparent">
    <div id="cube">
		<div id="cube_up" class="face top">top</div>
		<div id="cube_front" class="face front">front</div>
		<div id="cube_left" class="face left">left</div>
		<div id="cube_back" class="face back">back</div>
		<div id="cube_right" class="face right">right</div>
		<div id="cube_down" class="face bottom">bottom</div>
    </div>    </div>
</div>
    </div>
</div>

<script>
	
	var $TransformProperty = GetTransformProperty();
	function GetTransformProperty()
	{
		var props = 'transform WebkitTransform MozTransform OTransform msTransform'.split(' '),
		prop,
		el = document.createElement('div');
		
		for(var i = 0, l = props.length; i < l; i++) {
			if(typeof el.style[props[i]] !== "undefined") {
				return props[i];
			}
		}

		return undefined;
	}
	
	var xAngle = 0, yAngle = 0;
	//var zTrans = 800;	//	center. Need to change this to account for fov
	var zTrans = 700;	//	center. Need to change this to account for fov

	function OnTransformChanged()
	{
		var $Transform = "rotateX("+xAngle+"deg) rotateY("+yAngle+"deg)";
		document.getElementById('cube').style[$TransformProperty] = $Transform;
		var $ParentTransform = "translateZ("+zTrans+"px)";
		document.getElementById('cube').parentNode.style[$TransformProperty] = $ParentTransform;
	}
	OnTransformChanged();

function ascii (a) { return a.charCodeAt(0); }
	function OnKeyDown(evt)
	{
		switch(evt.keyCode) {
			case 37: // left
			yAngle -= 90;
			break;
			
			case 38: // up
			xAngle += 90;
			evt.preventDefault();
			break;
			
			case 39: // right
			yAngle += 90;
			break;
			
			case 40: // down
			xAngle -= 90;
			evt.preventDefault();
			break;
			
			case ascii('A'):
			zTrans += 50;
			evt.preventDefault();
			console.log(zTrans);
			break;

			case ascii('Z'):
			zTrans -= 50;
			evt.preventDefault();
			console.log(zTrans);
			break;
		};
		OnTransformChanged();
	}

	function AutoRotate()
	{
		yAngle += 1;
		xAngle += 0.01;
		OnTransformChanged();
		setTimeout( AutoRotate, 1000/30 );
	}
	AutoRotate();
	
	document.body.onkeydown = OnKeyDown;


function CubemapLayout()
{
	this.mFront = new THREE.Vector2(0,1);
	this.mBack = new THREE.Vector2(0,1);
	this.mLeft = new THREE.Vector2(0,1);
	this.mRight = new THREE.Vector2(0,1);
	this.mUp = new THREE.Vector2(0,1);
	this.mDown = new THREE.Vector2(0,1);
}

function ScaleVectors($a,$b)
{
	return new THREE.Vector2( $a.x * $b.x, $a.y * $b.y );
}

CubemapLayout.prototype.GetFront = function($Size)	{	return ScaleVectors( this.mFront, $Size );	}
CubemapLayout.prototype.GetBack = function($Size)	{	return ScaleVectors( this.mBack, $Size );	}
CubemapLayout.prototype.GetLeft = function($Size)	{	return ScaleVectors( this.mLeft, $Size );	}
CubemapLayout.prototype.GetRight = function($Size)	{	return ScaleVectors( this.mRight, $Size );	}
CubemapLayout.prototype.GetUp = function($Size)		{	return ScaleVectors( this.mUp, $Size );	}
CubemapLayout.prototype.GetDown = function($Size)	{	return ScaleVectors( this.mDown, $Size );	}

//	intialise cube faces
function SetCubemapBackground($Front,$Back,$Left,$Right,$Up,$Down)
{
	var $ImageUrl = 'cubemap.jpg';
	var $ImageSize = new THREE.Vector2( 400, 300 );
	var $FaceWidth = 100;
	var $FaceHeight = 100;

	var $Layout = new CubemapLayout();
	SetFaceBackground( $Front, $Layout.GetFront($ImageSize), $ImageSize );
	SetFaceBackground( $Back, $Layout.GetBack($ImageSize), $ImageSize );
	SetFaceBackground( $Left, $Layout.GetLeft($ImageSize), $ImageSize );
	SetFaceBackground( $Right, $Layout.GetRight($ImageSize), $ImageSize );
	SetFaceBackground( $Up, $Layout.GetUp($ImageSize), $ImageSize );
	SetFaceBackground( $Down, $Layout.GetDown($ImageSize), $ImageSize );
}

function SetFaceBackground($Element,$ImageOffset,$ImageSize)
{
	if ( !$Element )
		return;
	
	var $x = -$ImageOffset.x;
	var $y = -$ImageOffset.x;
	$Element.style.background_position = "" + $x + 'px ' + $y + 'px';
	$Element.style.background_size = "" + $ImageSize.x + 'px ' + $ImageSize.y + 'px';
}

SetCubemapBackground( GetElement('cube_front'), GetElement('cube_back'), GetElement('cube_left'), GetElement('cube_right'), GetElement('cube_up'), GetElement('cube_down') );



</script>



</body>
</html>
